(function(){'use strict';function getErrorEl(input){let el=input.closest('[data-ssp-field]')||input.parentElement;let msg=el&&el.querySelector('.ssp-field-error');if(!msg){msg=document.createElement('div');msg.className='ssp-field-error';msg.style.cssText='color:#b30000;font-size:12px;line-height:1.4;margin-top:4px;display:none;';(el||input.parentElement||input).appendChild(msg);}
return msg;}
function setFieldError(input,message){const msg=getErrorEl(input);if(message){msg.textContent=message;msg.style.display='block';input.setAttribute('aria-invalid','true');}else{msg.textContent='';msg.style.display='none';input.removeAttribute('aria-invalid');}}
function isRadioOrCheckbox(el){return el.type==='radio'||el.type==='checkbox';}
function isContentEditable(el){return!!el&&(el.isContentEditable||el.getAttribute&&el.getAttribute('contenteditable')==='true');}
function getFieldValue(el){if(isContentEditable(el)){return(el.textContent||'').trim();}
return(el.value||'').trim();}
function validateField(input){if(input.disabled)return{valid:true};const rect=input.getBoundingClientRect();if(!isContentEditable(input)&&rect.width===0&&rect.height===0&&input.type!=='hidden'){return{valid:true};}
let customMessage='';if(input.required){if(isRadioOrCheckbox(input)){const name=input.name;const form=input.form||document;const group=form.querySelectorAll('input[name="'+CSS.escape(name)+'"][type="'+input.type+'"]');let anyChecked=false;group.forEach(i=>{if(i.checked)anyChecked=true;});if(!anyChecked){customMessage=customMessage||'This field is required.';}}else if(input.type==='file'){if(!input.files||input.files.length===0){customMessage=customMessage||'Please select a file.';}}else if(!input.value||input.value.trim()===''){customMessage=customMessage||'This field is required.';}}
if(!customMessage&&input.pattern){try{const re=new RegExp('^'+input.pattern+'$');if(input.value&&!re.test(input.value)){customMessage='Please match the requested format.';}}catch(e){}}
if(!customMessage&&input.value){switch(input.type){case'email':if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value)){customMessage='Please enter a valid email address.';}
break;case'url':try{new URL(input.value);}catch(e){customMessage='Please enter a valid URL.';}
break;case'number':const val=Number(input.value);if(Number.isNaN(val)){customMessage='Please enter a number.';}else{if(input.min!==''&&val<Number(input.min)){customMessage='Value must be greater than or equal to '+input.min+'.';}
if(!customMessage&&input.max!==''&&val>Number(input.max)){customMessage='Value must be less than or equal to '+input.max+'.';}
if(!customMessage&&input.step&&input.step!=='any'){const step=Number(input.step);if(step>0){const base=input.min!==''?Number(input.min):0;const diff=(val-base)/ step;if(Math.abs(diff-Math.round(diff))>1e-8){customMessage='Please enter a valid value.';}}}}
break;}}
if(!customMessage&&input.value){if(input.maxLength&&input.maxLength>0&&input.value.length>input.maxLength){customMessage='Please shorten this text to '+input.maxLength+' characters or less.';}
if(!customMessage&&input.minLength&&input.value.length<input.minLength){customMessage='Please lengthen this text to at least '+input.minLength+' characters.';}}
if(!customMessage&&input.type==='file'&&input.accept&&input.files&&input.files.length){const accepts=input.accept.split(',').map(a=>a.trim().toLowerCase());for(const f of input.files){const name=f.name.toLowerCase();const type=(f.type||'').toLowerCase();const ok=accepts.some(acc=>{if(acc.startsWith('.'))return name.endsWith(acc);if(acc.endsWith('/*'))return type.startsWith(acc.slice(0,-1));return type===acc;});if(!ok){customMessage='Selected file type is not allowed.';break;}}}
if(customMessage){setFieldError(input,customMessage);return{valid:false,message:customMessage};}else{setFieldError(input,'');return{valid:true};}}
function markRequiredFromAria(form){try{const inputs=form.querySelectorAll('input');const textareas=form.querySelectorAll('textarea');const selects=form.querySelectorAll('select');inputs.forEach(el=>{if(el.getAttribute('aria-required')==='true'){el.required=true;}});textareas.forEach(el=>{if(el.getAttribute('aria-required')==='true'){el.required=true;}});selects.forEach(el=>{if(el.getAttribute('aria-required')==='true'){el.required=true;}});}catch(e){}}
function attachValidationToForm(form){if(!form||form.__sspValidationAttached)return;form.__sspValidationAttached=true;form.setAttribute('novalidate','novalidate');markRequiredFromAria(form);const inputSelector='input, select, textarea, [contenteditable]';const fields=form.querySelectorAll(inputSelector);fields.forEach(field=>{const handler=()=>validateField(field);field.addEventListener('blur',handler);field.addEventListener('input',handler);if(isRadioOrCheckbox(field)){field.addEventListener('change',handler);}});form.addEventListener('submit',function(e){let firstInvalid=null;let valid=true;fields.forEach(field=>{const res=validateField(field);if(!res.valid&&!firstInvalid){firstInvalid=field;valid=false;}});if(!valid){e.preventDefault();e.stopPropagation();if(firstInvalid&&typeof firstInvalid.focus==='function'){firstInvalid.focus({preventScroll:false});}
let top=form.querySelector('.ssp-form-error-summary');if(!top){top=document.createElement('div');top.className='ssp-form-error-summary';top.style.cssText='width:100%;background:#ffe0e0;color:#7a0000;padding:10px;margin:0 0 12px;border:1px solid #f5b5b5;';form.insertBefore(top,form.firstChild);}
top.textContent='Please fix the errors highlighted below and try again.';}else{const top=form.querySelector('.ssp-form-error-summary');if(top){top.textContent='';top.parentElement.removeChild(top);}}},true);}
function findFormBySettings(settings){if(settings.form_id){const byId=document.getElementById(settings.form_id);if(byId&&byId.tagName&&byId.tagName.toLowerCase()==='form'){return byId;}}
const elHidden=document.querySelector('form input[name="form_id"][value="'+CSS.escape(settings.form_id)+'"]');if(elHidden){return elHidden.closest('form');}
const cf7Hidden=document.querySelector('form input[name="_wpcf7"][value="'+CSS.escape(settings.form_id)+'"]');if(cf7Hidden){return cf7Hidden.closest('form');}
const gfHidden=document.querySelector('form input[name="gform_submit"][value="'+CSS.escape(settings.form_id)+'"]');if(gfHidden){return gfHidden.closest('form');}
const ffHidden=document.querySelector('form.frm-fluent-form input[name="_fluentform_id"][value="'+CSS.escape(settings.form_id)+'"]');if(ffHidden){return ffHidden.closest('form');}
const ffData=document.querySelector('form.frm-fluent-form[data-form-id="'+CSS.escape(settings.form_id)+'"]');if(ffData){return ffData;}
return null;}
function init(){const configMeta=document.querySelector("meta[name='ssp-config-path']");if(!configMeta){return;}
const versionMeta=document.querySelector("meta[name='ssp-config-version']");let version_suffix='';if(versionMeta){const v=versionMeta.getAttribute('content');if(v){version_suffix='?ver='+encodeURIComponent(v);}}
const configPath=configMeta.getAttribute('content');const configUrl=window.location.origin+configPath+'forms.json'+version_suffix;function markWrappers(form){try{form.querySelectorAll('input,select,textarea').forEach(inp=>{if(!inp.closest('[data-ssp-field]')){const wrappers=[inp.closest('.elementor-field-group'),inp.closest('.wpcf7-form-control-wrap'),inp.closest('.gfield'),].filter(Boolean);if(wrappers[0])wrappers[0].setAttribute('data-ssp-field','1');}});}catch(e){}}
function attachFromConfig(json){if(!Array.isArray(json))return;json.forEach(settings=>{const form=findFormBySettings(settings);if(form){markWrappers(form);attachValidationToForm(form);}});}
function attachFallbackAll(){const forms=document.querySelectorAll(".wpcf7 form, .wpcf7-form, .gform_wrapper form, .wpforms-container form, .elementor-form, .wsf-form, .frm-fluent-form, .brxe-form, .brxe-brf-pro-forms");forms.forEach(form=>{if(!form.__sspValidationAttached){markWrappers(form);attachValidationToForm(form);}});}
fetch(configUrl).then(r=>{if(!r.ok)throw new Error('HTTP '+r.status);return r.json();}).then(json=>{attachFromConfig(json);attachFallbackAll();}).catch(()=>{attachFallbackAll();});}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}})();